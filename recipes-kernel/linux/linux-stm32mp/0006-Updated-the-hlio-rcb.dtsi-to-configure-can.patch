From 5e84cd3aea7db3aa8935dffdf6cb03afbafdd386 Mon Sep 17 00:00:00 2001
From: Bernardo Garza <bernardo.garza@hlioengineering.com>
Date: Wed, 29 Sep 2021 08:26:27 -0700
Subject: [PATCH] Updated the hlio-rcb.dtsi to configure can

---
 arch/arm/boot/dts/stm32mp15xx-hlio-rcb.dtsi | 38 ++++++++++++++++++++-
 1 file changed, 37 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/stm32mp15xx-hlio-rcb.dtsi b/arch/arm/boot/dts/stm32mp15xx-hlio-rcb.dtsi
index d1318db57..4a2e4dcda 100644
--- a/arch/arm/boot/dts/stm32mp15xx-hlio-rcb.dtsi
+++ b/arch/arm/boot/dts/stm32mp15xx-hlio-rcb.dtsi
@@ -26,6 +26,22 @@ &sdmmc3 {
     /* USER CODE END sdmmc3 */
 };
 
+/* FDCAN configure */
+&m_can1 {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&m_can1_pins_mx>;
+	pinctrl-1 = <&m_can_sleep_pins_mx>;
+	status = "okay";
+};
+
+/* FDCAN configure */
+// &m_can2 {
+// 	pinctrl-names = "default", "sleep";
+// 	pinctrl-0 = <&m_can2_pins_mx>;
+// 	pinctrl-1 = <&m_can_sleep_pins_mx>;
+// 	status = "okay";
+// };
+
 &pinctrl {
 	u-boot,dm-pre-reloc;
 
@@ -82,4 +98,24 @@ pins {
 					 <STM32_PINMUX('G', 15, ANALOG)>; /* SDMMC3_CK */
 		};
 	};
-};
\ No newline at end of file
+
+	m_can1_pins_mx: m_can1_mx-0 {
+		pins0 {
+			pinmux = <STM32_PINMUX('A', 11, AF9)>, /* CAN1_RX */
+					 <STM32_PINMUX('A', 12, AF9)>; /* CAN1_TX */
+		};
+	};
+
+	// m_can2_pins_mx: m_can1_mx-0 {
+	// 	pins0 {
+	// 		pinmux = <STM32_PINMUX('B', 5, AF9)>,  /* CAN1_RX */
+	// 				 <STM32_PINMUX('B', 13, AF9)>; /* CAN1_TX */
+	// 	};
+	// };
+
+	m_can_sleep_pins_mx: m_can1_sleep_mx-0 {
+		pins0 {
+			pinmux = <STM32_PINMUX('A', 8, GPIO)>; /* CAN1_SLEEP */
+		};
+	};
+};
-- 
2.25.1

